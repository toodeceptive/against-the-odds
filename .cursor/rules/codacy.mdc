---
description: Configuration for AI behavior when interacting with Codacy's MCP Server
globs: []
alwaysApply: true
---
# Codacy Rules

Configuration for AI behavior when interacting with Codacy's MCP Server

## PRIMARY: When Codacy MCP Server tools ARE available

### After ANY successful file edit

- Run the `codacy_cli_analyze` tool for each edited file, with:
  - `rootPath`: workspace path (standard, non-URL-encoded)
  - `file`: path of the edited file
  - `tool`: leave empty
- If issues are found, propose and apply fixes.

### After every response with file edits

- Verify you ran `codacy_cli_analyze` for each edited file.

## FALLBACK: When Codacy MCP Server tools are NOT available (no codacy server in MCP list)

- **Do NOT fail or block.** Proceed with the task.
- Run `npm run quality` (format, lint, test) as equivalent coverage.
- Optionally run `npm run codacy:analyze` for local Codacy CLI analysis (requires bash).
- Optionally add a brief note: "Codacy analysis skipped (MCP unavailable)."
- **Do NOT** repeatedly prompt the user or treat this as a critical error.

## When Codacy CLI is not installed (MCP available but CLI missing)

- Ask: "Codacy CLI is not installed. Would you like me to install it now?"
- If "yes": run `codacy_cli_install`, then continue.
- If "no": suggest disabling automatic analysis in extension settings; wait for response.

## MCP troubleshooting (when user reports Codacy failures)

- Suggest: reset MCP on Codacy extension; check Copilot MCP in GitHub settings ([github.com/settings/copilot/features](https://github.com/settings/copilot/features)); restart Cursor.
- See [docs/CODACY_MCP_SETUP.md](docs/CODACY_MCP_SETUP.md) for full guide.

## rootPath parameter

- Use standard, non-URL-encoded file system path (e.g. `c:\Users\...\against-the-odds`).

## Dependencies and Security Checks (when Codacy MCP is available)

- After `npm install`, adding dependencies, or package manager operations:
- Running npm/yarn/pnpm install
- Adding dependencies to package.json
- Adding requirements to requirements.txt
- Adding dependencies to pom.xml
- Adding dependencies to build.gradle
- Any other package manager operations
- You MUST run the `codacy_cli_analyze` tool with:
- `rootPath`: set to the workspace path
- `tool`: set to "trivy"
- `file`: leave empty or unset
- If any vulnerabilities are found because of the newly added packages:
- Stop all other operations
- Propose and apply fixes for the security issues
- Only continue with the original task after security issues are resolved
- EXAMPLE:
- After: npm install react-markdown
- Do: Run codacy_cli_analyze with trivy
- Before: Continuing with any other tasks

## General

- Repeat the relevant steps for each modified file.
- "Propose fixes" means to both suggest and, if possible, automatically apply the fixes.
- You MUST NOT wait for the user to ask for analysis or remind you to run the tool.
- Do not run `codacy_cli_analyze` looking for changes in duplicated code or code complexity metrics.
- Complexity metrics are different from complexity issues. When trying to fix complexity in a repository or file, focus on solving the complexity issues and ignore the complexity metric.
- Do not run `codacy_cli_analyze` looking for changes in code coverage.
- Do not try to manually install Codacy CLI using either brew, npm, npx, or any other package manager.
- If the Codacy CLI is not installed, just run the `codacy_cli_analyze` tool from Codacy's MCP Server.
- When calling `codacy_cli_analyze`, only send provider, organization and repository if the project is a git repository.

## Whenever a call to a Codacy tool that uses `repository` or `organization` as a parameter returns a 404 error

- Offer to run the `codacy_setup_repository` tool to add the repository to Codacy
- If the user accepts, run the `codacy_setup_repository` tool
- Do not ever try to run the `codacy_setup_repository` tool on your own
- After setup, retry once.

## Summary

- **MCP available** → run codacy_cli_analyze on edited files; run trivy after dependency changes.
- **MCP unavailable** → run `npm run quality`; do not block or fail.
